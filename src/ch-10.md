# 第十章 承接任务

### 领受任务

接收到客户提供的开发文档和期望的效果图，谈好日期和要求等。

<hr/>

### 任务分析

主要考虑数据库和角色权限的设计，网页页面尽量快捷美观。

#### 数据库中表的设计

##### 课程表的说明

* 课程编号为8个数字，比如01020304表示说明书上的编号为1.2.03.04

* 权重值是没有乘上级课程的权重值。在程序中计算成绩时，需要考虑上级课程权重值对本级课程权重值的影响。


##### 成绩表

*分为两个表，一个为入单位前的成绩表，固定不变的。一个为在单位期间的成绩表，一个学号一个课程号对应一个成绩。*

我感觉应该分为一个总表和若干分表。一个成绩总表跟在单位期间的各科对应的课程表。

* 成绩总表
    - 把所有的课程（有无成绩）的都加以保存。（*没有直接成绩的，记录加权后的合成成绩。*）
    - 所有科目命名，采用cid_01020304的方式，代表说明书上编号为1.2.03.04的课程。

* 成绩分表
    - 分表的总数很多。
    - 分表的命名方式，tb_cid_01020304，代表说明书上编号为1.2.03.04的课程。
    - 分表的构造形式，可能不尽相同。比如251、252练习，次数不同，因此成绩形式也不一样。
    - 对于成绩评定，需要考虑考查跟考试课程的区别。（**具体方法，待定**）

#### 角色权限设计

* 都是注册用户，所以游客(guest)不存在。
* 为了方便，暂时这么设定人员。
	+ 0 学员
	+ 1 教员
	+ 2-8 备用
	+ 9 管理员
	+ 其他 非法
* 采用relations的方式，在User跟Student,Teacher等互相索引，以解决登录统一接口跟角色不同之间的矛盾。

<hr/>

### 总体构思

关于用户登录，实现前后端采用不同的方式来登录。

#### 一、搭建Yii 2.0开发环境和测试环境

现在已经完成开发环境搭建，测试环境由于个人精力有限，暂时不做。

#### 二、Yii 2.0 advanced 版本初始化，git 初始化

这个已经实现

#### 三、搜集资料，查看文档

搜集的资料，暂时确定选择四本书以及若干源代码视频参考：

**书籍：**
+ 《The Definitive Guide to Yii 2.0》
知道Yii 2.0大概内容
+ 《Yii 2 for beginners》
了解要开发的一般流程
+ 《Learning Yii Test》
待读

**源码：**
+ https://github.com/shi-yang/iisns
+ https://github.com/michaelweixi/Yii2Blog

**视频：**
+ 魏曦系列视频 http://i.youku.com/weixistyle

以及项目计划书。

#### 四、开发网站的一般流程

1. 数据库设计
2. 用户登录实现
3. gii数据表生成
4. 其他功能实现
5. 辅助功能实现，比如上传文件等
6. 测试

#### 五、本网站开发流程

##### 1. 前端学员数据库设计(大部分完成)

+ 登录用户信息`tbl_user`
+ 学员信息`tbl_student`，类似一般网站的`tbl_profile`
+ 学员成绩表`tbl_score`
+ 学员目标设定成绩`tbl_aim_score`
+ 课程表`tbl_course`
+ 某单一课程的成绩表`tbl_cid_xxx`
+ 班级年级表`tbl_unit`
+ 其他需要的表，比如`tbl_gender`,`tbl_role`和`tbl_status`等，参考《Yii 2.0 for beginners》

##### 2. 修改用户登录（已完成）

+ 加入多语言支持，采用现有插件
+ 实现前端的用户登录
+ 暂时保留注册页面，完成后转移到后台，仅管理员有权限添加删除用户。
+ 待加

##### 3. 框架构思（完成）

前端显示页面如下图。

![框架图](../images/ch13-frontend.png)

+ 侧边栏主要是针对特定角色的人提供不同的菜单
+ 上面的一栏提供共同的信息，或者是侧边栏的重复
+ 主页面，显示主要内容。

##### 4. 为每一个角色设计菜单（待完善）

先设计好菜单，逐步为每一个菜单实现功能。

+ 学员
+ 教员
+ 班主任
+ 年级组长

共同的菜单项
+ 下载
+ 往届信息
+ 其他

##### 5. 完成各个菜单的功能（待完善）

+ 注意参考视频教程的内容
+ 对应多课程的大量重复加入，可否设计改进

##### 6. 后台设计（待完善）

+ 参考别人的后台形式
+ 后台的功能有哪些？

##### 7. 测试（待完善）

待定

##### 8. 花90%的时间做剩下10%的工作

+ 优化，试运行

#### 六、开发进度安排

最好在两个月内完成。

* 2015.11.01-2015.12.01 实现查阅资料文档和初步设计
* 2015.12.01-2016.01.01 草稿完成
其中：
  + 第一周 菜单的设计以及测试环境的搭建
  + 第二三周 菜单功能实现以及问题总结
  + 第四周 设计后台
  + 第五周 测试
* 2016.01.01- 待定 